<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="mayylu">



    <meta name="description" content="学习是一种生活态度">



<title>golang语法速查 | mayylu&#39;s blog</title>



    <link rel="icon" href="/vue.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">mayylu&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">mayylu&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">golang语法速查</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">mayylu</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十二月 12, 2024&nbsp;&nbsp;</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Golang/">Golang</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>第一次用go是大二的时候，那个时候招新用到github上的项目，但是万万没想到的是那个项目有个bug，redis里的session没有清除机制，一段时间后就会爆满导致网站服务崩溃，一开始测试的时候没问题，但是上线那一天一上强度就503了。那段时间压力爆炸，改时间已经来不及了已经有部分题目被学弟写了，他那个框架我也没学过修bug也来不及了。也是疯狂查资料，最后用的一个定时清除reids连接的go脚本，打包编译上传到docker里，才解决这个问题，这时我对go的印象是作为脚本可以一点不依靠环境配置，docker里面什么语言环境都没有，但是我用go生成的二进制文件直接就执行成功了</p>
<p>最近想写资产测绘工具当作毕设，并且平时挖src也能用上，就简单分析了一个go写的开源渗透工具，看完这个工具后也是感觉到了go语言的便利，有类似python的弱类型，有类似java的类和包结构，甚至还有类似C的指针和结构体,也正因如此就决定毕设用go写而不是用更熟悉的python写</p>
<span id="more"></span>
<h2 id="go语言的基础命令"><a href="#go语言的基础命令" class="headerlink" title="go语言的基础命令"></a>go语言的基础命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">go run hello.go </span><br><span class="line">go build hello.go <span class="comment">#生成二进制文件</span></span><br><span class="line">./hello</span><br><span class="line">go env -w GOPROXY=<span class="string">&quot;https://goproxy.cn,direct&quot;</span>  <span class="comment">#设置导包的代理</span></span><br><span class="line">go install example.com/mytool@latest <span class="comment">#相当于拉取源码后build,下载打包好的可执行文件到go\workpace\bin</span></span><br></pre></td></tr></table></figure>
<h2 id="Go语言环境配置"><a href="#Go语言环境配置" class="headerlink" title="Go语言环境配置"></a>Go语言环境配置</h2><p>GOROOT：指向 Go 安装目录，通常是 Go 自带的安装路径，包含了 Go 的标准库、工具链等</p>
<p>GOPATH：指向你的工作空间目录<br>    src：源代码存放目录，包括你自己的项目代码和go install导入的外部包。<br>    pkg：编译后的包文件存放目录，包括使用 go install 命令生成的二进制文件。<br>    bin：可执行文件存放目录，包括使用 go install 命令生成的可执行文件。</p>
<p>GOMODCACHE：但是GOPATH规定编程只能在<code>$GOPATH/src</code>下很是麻烦，所以从 <strong>Go 1.11</strong> 开始，Go 模块系统简化了依赖管理，并使得 GOPATH 不再是必需的，允许你在任何目录下开发 Go 项目<br>依赖管理通过go.mod(记录模块的依赖关系、版本等信息)和go.sum(保证了这些依赖的完整性和安全性)文件来完成(类似于python的<code>pip install -r requirements.txt</code>),下载的包在<code>$GOPATH/pkg/mod</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启GOMODCACHE</span></span><br><span class="line"><span class="built_in">export</span> GO111MODULE=on <span class="comment">#on， 不管在不在gopath/src下，都采用的go mod包管理方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化 Go 模块：</span></span><br><span class="line">go mod init &lt;module-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加或更新依赖到$GOPATH/pkg/mod，修改 go.mod：</span></span><br><span class="line">go get &lt;package&gt;@&lt;version&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#清理未使用的依赖项,生成或更新 go.sum：</span></span><br><span class="line">go mod tidy</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证依赖的完整性：</span></span><br><span class="line">go mod verify</span><br></pre></td></tr></table></figure>
<p>go v1.5引入vendor模式，如果项目目录下有vendor目录，那么go工具链会优先使用vendor内的包进行编译、测试</p>
<h2 id="go基础语法"><a href="#go基础语法" class="headerlink" title="go基础语法"></a>go基础语法</h2><h3 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//变量</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">10</span> </span><br><span class="line">a := <span class="number">10</span> <span class="comment">//支持弱类型</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span></span><br><span class="line">a:=<span class="keyword">interface</span>&#123;&#125; <span class="comment">//空接口可以持有任何类型的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//map</span></span><br><span class="line">m1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123; <span class="comment">//[键]值</span></span><br><span class="line">        <span class="string">&quot;a&quot;</span>: <span class="string">&quot;test1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;b&quot;</span>: <span class="string">&quot;test2&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">m1 [<span class="string">&quot;c&quot;</span>] = <span class="string">&quot;test3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//数组</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>] <span class="keyword">string</span> <span class="comment">//数组的大小是固定的</span></span><br><span class="line"><span class="keyword">var</span> b = [...] <span class="keyword">int</span> &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125; <span class="comment">//自行推断数组的长度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体</span></span><br><span class="line"><span class="keyword">type</span> conf <span class="keyword">struct</span> &#123;</span><br><span class="line">        name <span class="keyword">string</span></span><br><span class="line">        age <span class="keyword">int</span></span><br><span class="line">    &#125;</span><br><span class="line">a := conf&#123;name: <span class="string">&quot;d4m1ts&quot;</span>, age: <span class="number">18</span>&#125;<span class="comment">//创建一个实例</span></span><br><span class="line"></span><br><span class="line">conf := <span class="built_in">new</span>(conf)<span class="comment">//创建了一个指向 Conf 类型结构体的指针，并初始化了 Conf 结构体的零值</span></span><br><span class="line">conf := &amp;Conf&#123;&#125;</span><br><span class="line">conf.name = <span class="string">&quot;d4m1ts&quot;</span><span class="comment">//修改name字段的值</span></span><br></pre></td></tr></table></figure>
<h4 id="指针的使用"><a href="#指针的使用" class="headerlink" title="指针的使用"></a>指针的使用</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指针</span></span><br><span class="line"><span class="keyword">var</span> ip *<span class="keyword">int</span>        <span class="comment">/* 声明指针变量 */</span></span><br><span class="line">ip = &amp;a  <span class="comment">/* 指针变量的存储地址 */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">appendOne</span><span class="params">(s *[]<span class="keyword">int</span>)</span></span> &#123;  <span class="comment">//不传入指针，就只是切片的拷贝</span></span><br><span class="line">	*s = <span class="built_in">append</span>(*s, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s2 := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">0</span>&#125;</span><br><span class="line">	appendOne(&amp;s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="关于切片"><a href="#关于切片" class="headerlink" title="关于切片"></a>关于切片</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切片大小是不固定的</span></span><br><span class="line"><span class="keyword">var</span> c []<span class="keyword">string</span> <span class="comment">//定义切片</span></span><br><span class="line"><span class="keyword">var</span> numbers = <span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">3</span>,<span class="number">5</span>) <span class="comment">//[0 0 0] 长度为3，容量为5</span></span><br><span class="line">c := [] <span class="keyword">string</span> &#123;<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>, <span class="string">&quot;cc&quot;</span>&#125; <span class="comment">//切片是动态的</span></span><br><span class="line">c = <span class="built_in">append</span>(c, <span class="string">&quot;ee&quot;</span>,<span class="string">&quot;ff&quot;</span>,<span class="string">&quot;gg&quot;</span>)<span class="comment">//同时添加多个元素</span></span><br><span class="line">d1 := [<span class="number">10</span>]<span class="keyword">int</span> &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>&#125; <span class="comment">//使用数组来初始化切片</span></span><br><span class="line">x := d1[<span class="number">2</span>:]</span><br><span class="line">c = <span class="built_in">append</span>(c, x...) <span class="comment">//合并2个切片，注意的是要添加...</span></span><br></pre></td></tr></table></figure>


<p>本来想着学完go语言之后刷刷ctf题目,结果在一道2019年题目中发现有一个有意思的地方</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//空切片，同var a []int</span></span><br><span class="line">a := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)<span class="comment">//len=0 cap=0 slice=[]</span></span><br><span class="line"></span><br><span class="line">a = <span class="built_in">append</span>(a, <span class="number">1</span>)<span class="comment">//len=1 cap=1 slice=[1]</span></span><br><span class="line">a = <span class="built_in">append</span>(a, <span class="number">2</span>)<span class="comment">//len=2 cap=2 slice=[1 2]</span></span><br><span class="line">a = <span class="built_in">append</span>(a, <span class="number">3</span>)<span class="comment">//len=3 cap=4 slice=[1 2 3]</span></span><br><span class="line">a = <span class="built_in">append</span>(a, <span class="number">4</span>)<span class="comment">//len=4 cap=4 slice=[1 2 3 4]</span></span><br><span class="line">a = <span class="built_in">append</span>(a, <span class="number">5</span>)<span class="comment">//len=5 cap=8 slice=[1 2 3 4 5]</span></span><br><span class="line">b := <span class="built_in">append</span>(a, <span class="number">6</span>)<span class="comment">//len=6 cap=8 slice=[1 2 3 4 5 6]</span></span><br><span class="line">c := <span class="built_in">append</span>(a, <span class="number">7</span>)<span class="comment">//len=6 cap=8 slice=[1 2 3 4 5 7]</span></span><br><span class="line"></span><br><span class="line">fmt.Println(a)<span class="comment">//[1,2,3,4,5]</span></span><br><span class="line">fmt.Println(b)<span class="comment">//[1,2,3,4,5,7]</span></span><br><span class="line">fmt.Println(c)<span class="comment">//[1,2,3,4,5,7]</span></span><br></pre></td></tr></table></figure>
<p>为什么b最后一位是7拿，因为切片存储空间cap是2的倍数，如果是存储空间cap从5-&gt;9,它就会深拷贝到一个cap16的地方，在本例子中，是从cap5-&gt;6，那么b就是a的引用然后len为6，后面c跟b的情况一样都是更改了a的后一位，导致b也被改变了</p>
<p>很神奇，它这个地方居然是深拷贝和浅拷贝的混用，我第一眼看到那道题的时候也懵了</p>
<h3 id="逻辑语法"><a href="#逻辑语法" class="headerlink" title="逻辑语法"></a>逻辑语法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//for语句</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [] <span class="keyword">int</span> &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> _,i := <span class="keyword">range</span> a &#123;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sum &lt;= <span class="number">10</span>&#123;</span><br><span class="line">      sum += sum</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">text</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%d &quot;</span>, i)      </span><br><span class="line">		<span class="keyword">defer</span> fmt.Printf(<span class="string">&quot;%d &quot;</span>, i) </span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%d &quot;</span>, <span class="number">11</span>)</span><br><span class="line">&#125;<span class="comment">//0 1 2 3 4 11 4 3 2 1 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> test</span><br><span class="line"><span class="comment">//静态函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span>  <span class="title">TestFunc1</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line">s= test.TestFunc1(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义接口</span></span><br><span class="line"><span class="keyword">type</span> testImpl <span class="keyword">interface</span> &#123;</span><br><span class="line">    testFunc1(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> testStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现结构体的接口函数，形成类</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(testMethod testStruct)</span> <span class="title">TestFunc1</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">var</span> test1 testImpl</span><br><span class="line">    test1 := <span class="built_in">new</span>(testStruct) <span class="comment">// 实例化</span></span><br><span class="line">    res1 := test1.TestFunc1(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">    fmt.Println(res1)</span><br></pre></td></tr></table></figure>
<p>先写个大概，开发时遇到不会写的再往上加</p>
<h2 id="go自带的常用包"><a href="#go自带的常用包" class="headerlink" title="go自带的常用包"></a>go自带的常用包</h2><h3 id="并发与管道"><a href="#并发与管道" class="headerlink" title="并发与管道"></a>并发与管道</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//select </span></span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>) <span class="comment">// 定义两个通道</span></span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> msg1 := &lt;-ch1:<span class="comment">//当通道有值时，case可以运行,如果有多个 case 都可以运行，Select 会随机公平地选出一个执行</span></span><br><span class="line">      fmt.Println(msg1)</span><br><span class="line">    <span class="keyword">case</span> msg2 := &lt;-ch2:</span><br><span class="line">      fmt.Println(msg2)</span><br><span class="line">    <span class="keyword">default</span>:<span class="comment">// 如果两个通道都没有可用的数据，则执行这里的语句；</span></span><br><span class="line">    <span class="comment">//如果没有default，并且没有case可运行，它将阻塞，直到有case可运行</span></span><br><span class="line">      fmt.Println(<span class="string">&quot;no message received&quot;</span>)</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//go程(go调用的协程)：M 个 Go程映射到 N 个线程，减少了线程的创建和切换开销</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loop</span><span class="params">(res <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i &lt; <span class="number">5</span> &#123;</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        res &lt;- i <span class="comment">//把i发送到通道res</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    res := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">5</span>) <span class="comment">//开启一个管道res类型为int,缓存区5代表最多可以开5个协程</span></span><br><span class="line">    <span class="keyword">go</span> loop(res) <span class="comment">//开一个go程</span></span><br><span class="line">    fmt.Println(&lt;-res)    <span class="comment">// 2,从res通道中接收一个结果</span></span><br><span class="line">    fmt.Println(&lt;-res)     <span class="comment">// 3</span></span><br><span class="line">    <span class="keyword">for</span> r := <span class="keyword">range</span> res&#123;    <span class="comment">// 遍历通道</span></span><br><span class="line">        fmt.Println(r)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(&lt;-res)     <span class="comment">// 0,表示已经消费完了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//但主协程（main）结束时，子协程（Go程）也会终止，可以使用sync让所有子协程都可以执行完</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()  <span class="comment">// defer当 goroutine 完成时，调用 Done()，减少计数器</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Worker %d is working\n&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)  <span class="comment">// 每次启动一个新的 goroutine，增加计数器</span></span><br><span class="line">        <span class="keyword">go</span> worker(i)  <span class="comment">// 启动 goroutine</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wg.Wait()  <span class="comment">// 等待所有 goroutine 完成</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;All workers are done!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//原子操作，保证同一时刻只有一个 goroutine 能够执行临界区代码</span></span><br><span class="line"><span class="keyword">var</span> mu sync.Mutex</span><br><span class="line"><span class="keyword">var</span> count <span class="keyword">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mu.Lock()         <span class="comment">// 锁定</span></span><br><span class="line">    count++</span><br><span class="line">    mu.Unlock()       <span class="comment">// 解锁</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123; <span class="comment">// 启动 10 个 goroutine</span></span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            increment()</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wg.Wait() <span class="comment">// 等待所有 goroutine 完成</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Final count:&quot;</span>, count)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><p>context 可以在多个 goroutine 之间共享取消信号或超时信号，很多 Go 的标准库和第三方库（如 net/http、database/sql 等）都与 context 紧密集成。例如，HTTP 请求的超时、数据库查询的取消操作等都依赖于 context</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//    ctx:=context.Background()</span></span><br><span class="line">    <span class="comment">//    ctx, cancel := context.WithCancel(context.Background())</span></span><br><span class="line">    <span class="comment">//    ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(5*time.Second))</span></span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), <span class="number">1</span>*time.Second) <span class="comment">//创建了一个过期时间为 1s 的上下文</span></span><br><span class="line">	<span class="keyword">defer</span> cancel()                                                          <span class="comment">//cancel 是一个取消函数，它会在超时或手动调用时通知 ctx</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> handle(ctx, <span class="number">500</span>*time.Millisecond)</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">//当超时发生时，ctx.Done() 会被触发</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;main&quot;</span>, ctx.Err()) <span class="comment">//Err — 返回context.Context结束的原因</span></span><br><span class="line">        deadline, _ := ctx.Deadline(); <span class="comment">//返回超时时间</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(ctx context.Context, duration time.Duration)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">		fmt.Println(<span class="string">&quot;handle&quot;</span>, ctx.Err())</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(duration):</span><br><span class="line">		fmt.Println(<span class="string">&quot;process request with&quot;</span>, duration)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    fmt.Scan 会读取空白分隔符分隔的值；</span></span><br><span class="line"><span class="comment">    fmt.Scanln 会在遇到换行符时停止读取。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">fmt.Scan(&amp;name)</span><br><span class="line">fmt.Print(<span class="string">&quot;Enter your age: &quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;age)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>) <span class="comment">// 输出：Hello, World!/n</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;Hello, %v!\n&quot;</span>, name) <span class="comment">// 输出：Hello, Go!,  %v：用于格式化任何类型的变量，以默认方式输出</span></span><br><span class="line"><span class="keyword">var</span> sentence = fmt.Sprintf(<span class="string">&quot;hello %s %s %d&quot;</span>, keyword, name, age)<span class="comment">//格式化拼接</span></span><br></pre></td></tr></table></figure>
<h3 id="基本数据类型处理"><a href="#基本数据类型处理" class="headerlink" title="基本数据类型处理"></a>基本数据类型处理</h3><h4 id="strconv类型转化"><a href="#strconv类型转化" class="headerlink" title="strconv类型转化"></a>strconv类型转化</h4><p>Go 的类型转换是显式的，你必须告诉编译器要如何转换类型，以避免类型不兼容问题。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// int 转字符串</span></span><br><span class="line">    str := strconv.Itoa(n)<span class="comment">//Integer to ASCII</span></span><br><span class="line">	str := strconv.FormatInt(<span class="number">255</span>, <span class="number">10</span>)<span class="comment">//也可以用FormatInt</span></span><br><span class="line">	fmt.Println(str) <span class="comment">// 输出字符串&quot;255&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符串转 int</span></span><br><span class="line">	num, err := strconv.Atoi(str)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// int 转 float64</span></span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">42</span></span><br><span class="line">	<span class="keyword">var</span> f <span class="keyword">float64</span> = <span class="keyword">float64</span>(i)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// float64 转 int</span></span><br><span class="line">	<span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">42.58</span></span><br><span class="line">	<span class="keyword">var</span> y <span class="keyword">int</span> = <span class="keyword">int</span>(x)  <span class="comment">//42</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符串转布尔值</span></span><br><span class="line">	str := <span class="string">&quot;true&quot;</span></span><br><span class="line">	b, err := strconv.ParseBool(str)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 布尔值转字符串</span></span><br><span class="line">	<span class="keyword">var</span> flag <span class="keyword">bool</span> = <span class="literal">true</span></span><br><span class="line">	s := strconv.FormatBool(flag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="strings处理字符串"><a href="#strings处理字符串" class="headerlink" title="strings处理字符串"></a>strings处理字符串</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(strings.Contains(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;world&quot;</span>)) <span class="comment">// 输出: true</span></span><br><span class="line">    fmt.Println(strings.Contains(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;golang&quot;</span>)) <span class="comment">// 输出: false</span></span><br><span class="line">    fmt.Println(strings.ToLower(<span class="string">&quot;HELLO WORLD&quot;</span>)) <span class="comment">// 输出: hello world</span></span><br><span class="line">    fmt.Println(strings.ToUpper(<span class="string">&quot;hello world&quot;</span>)) <span class="comment">// 输出: HELLO WORLD</span></span><br><span class="line">    result := strings.Split(<span class="string">&quot;a,b,c,d&quot;</span>, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">    fmt.Println(result) <span class="comment">// 输出: [a b c d]fmt.Println(strings.Replace(&quot;hello world&quot;, &quot;world&quot;, &quot;golang&quot;, 1)) // 输出: hello golang</span></span><br><span class="line">    result := strings.Join([]<span class="keyword">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>&#125;, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">    fmt.Println(result) <span class="comment">// 输出: a,b,c,d</span></span><br><span class="line">    fmt.Println(strings.Index(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;world&quot;</span>)) <span class="comment">// 输出: 6</span></span><br><span class="line">    fmt.Println(strings.Index(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;golang&quot;</span>)) <span class="comment">// 输出: -1</span></span><br><span class="line">    fmt.Println(strings.HasPrefix(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;hello&quot;</span>)) <span class="comment">// 输出: true</span></span><br><span class="line">    fmt.Println(strings.HasSuffix(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;world&quot;</span>)) <span class="comment">// 输出: true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span> <span class="comment">//与java不同，go要求在导入子包时必须显式地导入</span></span><br><span class="line">    <span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;bufio&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="获得当前路径"><a href="#获得当前路径" class="headerlink" title="获得当前路径"></a>获得当前路径</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cwd, _ := os.Getwd() <span class="comment">// 获取当前工作目录，由你运行程序时所在的目录决定，比方说你在c路径运行一个e路径的文件，工作目录还是c路径</span></span><br><span class="line">exePath:=os.Args[<span class="number">0</span>]<span class="comment">//运行该程序时指定的路径,注意：如果是本地调试运行没打包的化，会生成的临时可执行文件，如C:\Users\DELL\AppData\Local\Temp\GoLand\___go_build_test_go.exe</span></span><br><span class="line">exePath, err := os.Executable()</span><br></pre></td></tr></table></figure>
<h4 id="路径处理"><a href="#路径处理" class="headerlink" title="路径处理"></a>路径处理</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path := filepath.Join(<span class="string">&quot;api&quot;</span>, <span class="string">&quot;mayylu&quot;</span>, <span class="string">&quot;file.txt&quot;</span>)<span class="comment">//api\mayylu\file.txt</span></span><br><span class="line">cleanPath := filepath.Clean(path) <span class="comment">//规范化路由</span></span><br><span class="line">dir, file := filepath.Split(path)</span><br><span class="line">dir:=filepath.Dir(path)</span><br><span class="line">absPath, err := filepath.Abs(<span class="string">&quot;file.txt&quot;</span>) <span class="comment">// 转换相对路径为绝对路径</span></span><br><span class="line">ext := filepath.Ext(path)</span><br></pre></td></tr></table></figure>
<h4 id="展示路径下的文件"><a href="#展示路径下的文件" class="headerlink" title="展示路径下的文件"></a>展示路径下的文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    f, err := os.Open(<span class="string">&quot;./directory&quot;</span>) <span class="comment">// 打开目录,和打开文件的方法一样</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;打开目录时出错:&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> f.Close()</span><br><span class="line">fi, _ := f.Stat()</span><br><span class="line"><span class="keyword">if</span> fi.IsDir() &#123;<span class="comment">//判断是否是目录</span></span><br><span class="line">    l, _ := f.Readdir(<span class="number">0</span>)<span class="comment">// 读取目录中的所有文件和子目录</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> l &#123;  </span><br><span class="line">        fmt.Println(file.Name())<span class="comment">//打印目录中的文件和目录</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">files, _ := fileutil.ListFileNames(<span class="string">&quot;./directory&quot;</span>)<span class="comment">// 读取目录中的所有文件</span></span><br></pre></td></tr></table></figure>
<h4 id="获取文件的信息"><a href="#获取文件的信息" class="headerlink" title="获取文件的信息"></a>获取文件的信息</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_, err := os.Stat(filepath)  </span><br><span class="line"><span class="keyword">if</span> os.IsNotExist(err) &#123;    <span class="comment">// 判断文件是否不存在</span></span><br><span class="line">    <span class="comment">// 如果文件不存在</span></span><br><span class="line">    err := os.Mkdir(<span class="string">&quot;new_directory&quot;</span>, <span class="number">0755</span>) <span class="comment">// 创建目录，权限为 0755</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> fileutil.MiMeType(filepath) == <span class="string">&quot;application/zip&quot;</span> &#123;<span class="comment">//判断文件类型信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">file,_ := os.Open(<span class="string">&quot;test.txt&quot;</span>) <span class="comment">//简化的文件打开函数，通常用于以 只读 的方式打开文件</span></span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line">byteRes, _ := ioutil.ReadAll(file)    <span class="comment">// 返回存放结果</span></span><br><span class="line">fmt.Println(<span class="keyword">string</span>(byteRes))</span><br><span class="line"></span><br><span class="line">data, _ := ioutil.ReadFile(<span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用Scanner按行读取</span></span><br><span class="line">datas := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">scanner := bufio.NewScanner(file)    </span><br><span class="line"><span class="keyword">for</span> scanner.Scan()&#123;</span><br><span class="line">		datas = <span class="built_in">append</span>(datas, scanner.Text())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//embed 包利用注释，嵌入文件</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span>  </span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> content <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(content) <span class="comment">// 输出嵌入的文件内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fileutil.CreateDir(userDir)<span class="comment">//创建目录</span></span><br><span class="line">gobFile, _ := os.Create(userDir + <span class="string">&quot;user.gob&quot;</span>)<span class="comment">//创建文件</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">os.O_RDONLY：只读模式。</span></span><br><span class="line"><span class="comment">os.O_WRONLY：只写模式。</span></span><br><span class="line"><span class="comment">os.O_RDWR：读写模式。</span></span><br><span class="line"><span class="comment">os.O_CREATE：如果文件不存在，则创建文件。</span></span><br><span class="line"><span class="comment">os.O_APPEND：追加模式，写入内容时会自动追加到文件末尾。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">file,_ := os.OpenFile(<span class="string">&quot;test.txt&quot;</span>, os.O_RDWR | os.O_APPEND | os.O_CREATE, <span class="number">0666</span>) <span class="comment">// 按照特定权限打开，0666为新创建文件的权限</span></span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">data := []<span class="keyword">byte</span>(<span class="string">&quot;hello d4m1ts&quot;</span>)</span><br><span class="line">count, _ := file.Write(data)    <span class="comment">// 按字节写入，返回的count为写入的字节数</span></span><br><span class="line">count, _ = file.WriteString(<span class="string">&quot;\nHello D4m1ts&quot;</span>)    <span class="comment">// 按字符串写入</span></span><br><span class="line">file.Sync()    <span class="comment">//如果没有调用 file.Sync()，默认在文件关闭时自动同步文件的内容</span></span><br><span class="line"></span><br><span class="line">data := []<span class="keyword">byte</span>(<span class="string">&quot;hello d4m1ts&quot;</span>)</span><br><span class="line">ioutil.WriteFile(<span class="string">&quot;test.txt&quot;</span>, data, <span class="number">0666</span>)</span><br></pre></td></tr></table></figure>



<h3 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">)</span><br><span class="line">s:=os.Args[<span class="number">1</span>:]<span class="comment">//是用户在运行程序时传入的实际参数（如果有的话）</span></span><br><span class="line">sysType := runtime.GOOS <span class="comment">//获取当前程序运行的操作系统名称</span></span><br><span class="line"></span><br><span class="line">i:=time.Now().Unix() <span class="comment">//获得时间戳</span></span><br><span class="line">duration := time.Duration(<span class="number">5</span>) * time.Minute <span class="comment">//5d</span></span><br><span class="line">duration := <span class="number">1</span>*time.Second <span class="comment">//1s</span></span><br><span class="line">duration := <span class="number">500</span>*time.Millisecond <span class="comment">//500ms</span></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> ...</span><br><span class="line">    .....</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(duration):<span class="comment">//阻塞代码，一般运用等待执行</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;process request with&quot;</span>, duration)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-l&quot;</span>)<span class="comment">//命令执行</span></span><br><span class="line"></span><br><span class="line">output, err :=cmd.Output()<span class="comment">// 只捕获标准输出 (stdout)，如果命令失败，err 会包含错误</span></span><br><span class="line">output, err := cmd.CombinedOutput() <span class="comment">//执行命令并返回命令的标准输出和标准错误的合并输出</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;runcmd err : &quot;</span> + fmt.Sprint(err) + <span class="string">&quot;:&quot;</span> + <span class="keyword">string</span>(cmdOutput))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> outb, errs bytes.Buffer<span class="comment">// 创建两个字节缓冲区，分别用于捕获标准输出和标准错误</span></span><br><span class="line">cmd.Stdout = &amp;outb</span><br><span class="line">cmd.Stderr = &amp;errs</span><br><span class="line">err := cmd.Run()<span class="comment">//只执行命令并返回 error。</span></span><br><span class="line"></span><br><span class="line">os.Exit(<span class="number">0</span>) <span class="comment">// 正常退出</span></span><br><span class="line">os.Exit(<span class="number">1</span>) <span class="comment">// 错误退出</span></span><br></pre></td></tr></table></figure>
<h3 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h3><h4 id="域名-ip处理"><a href="#域名-ip处理" class="headerlink" title="域名/ip处理"></a>域名/ip处理</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;net&quot;</span></span><br><span class="line">)</span><br><span class="line">host := <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">port := <span class="string">&quot;8080&quot;</span>  </span><br><span class="line">address := net.JoinHostPort(host, port)</span><br><span class="line">fmt.Println(address)  <span class="comment">// 输出 &quot;127.0.0.1:8080&quot;</span></span><br><span class="line">host, port, err := net.SplitHostPort(address)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;net/url&quot;</span></span><br><span class="line">)</span><br><span class="line">    <span class="comment">//直接http post</span></span><br><span class="line">    http.Post(u, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, strings.NewReader(<span class="string">&quot;aa=bb&quot;</span>))<span class="comment">//将字符串封装成io.Reader类型的对象</span></span><br><span class="line">    resp, err := http.Post(url, <span class="string">&quot;application/json&quot;</span>, bytes.NewBuffer(jsonData))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接http get</span></span><br><span class="line">    baseURL := <span class="string">&quot;https://www.baidu.com/&quot;</span></span><br><span class="line">    Url, _ := baseURL.Parse(u)</span><br><span class="line">    param.Set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;d4m1ts&quot;</span>)</span><br><span class="line">    Url.RawQuery = param.Encode()<span class="comment">//url编码，并设置参数</span></span><br><span class="line">    <span class="comment">//fmt.Sprintf(&quot;%s?%s&quot;, baseURL, params.Encode())</span></span><br><span class="line">    response,_ := http.Get(Url.String())    <span class="comment">// 发起get请求</span></span><br><span class="line">    <span class="keyword">defer</span> response.Body.Close()<span class="comment">//可写可不写，不强制</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个HTTP请求，但是不发送请求</span></span><br><span class="line">    u := <span class="string">&quot;http://httpbin.org/&quot;</span></span><br><span class="line">    <span class="comment">//req,_:= http.NewRequestWithContext(ctx, &quot;GET&quot;, &quot;https://example.com&quot;, nil)使得请求在context规定的时间内如果没有完成就会自动被取消</span></span><br><span class="line">    req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, u, <span class="literal">nil</span>) <span class="comment">//nil 在 Go 中表示一个零值，用于表示一个空的或未初始化的变量，这里指没有post body数据</span></span><br><span class="line">    req.Header.Set(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Test GO&quot;</span>)<span class="comment">//自定义header头</span></span><br><span class="line">    </span><br><span class="line">    transport := &amp;http.Transport&#123;</span><br><span class="line">	Proxy: http.ProxyFromEnvironment, <span class="comment">// 如果有代理，使用环境变量中配置的代理设置</span></span><br><span class="line">	DialContext: (&amp;net.Dialer&#123;</span><br><span class="line">		Timeout:   <span class="number">60</span> * time.Second,    <span class="comment">// 设置连接超时时间</span></span><br><span class="line">		KeepAlive: <span class="number">60</span> * time.Second,    <span class="comment">// 设置连接保持时间</span></span><br><span class="line">	&#125;).DialContext,                   <span class="comment">// 使用 DialContext 来自定义连接建立过程</span></span><br><span class="line">	MaxIdleConnsPerHost: <span class="number">100</span>,          <span class="comment">// 限制每个主机的最大空闲连接数（负数表示不限制）</span></span><br><span class="line">    MaxIdleConns:        <span class="number">100</span>,         <span class="comment">//整个连接池中可以保持的最大空闲连接数</span></span><br><span class="line">	TLSClientConfig: &amp;tls.Config&#123;</span><br><span class="line">		InsecureSkipVerify: <span class="literal">true</span>,      <span class="comment">//跳过 SSL/TLS 证书验证</span></span><br><span class="line">	&#125;,</span><br><span class="line">	DisableKeepAlives: <span class="literal">true</span>,          <span class="comment">// 禁用 HTTP Keep-Alive，关闭持久连接</span></span><br><span class="line">&#125;</span><br><span class="line">    client := http.Client&#123;</span><br><span class="line">        Timeout: <span class="number">3</span>*time.Second,    <span class="comment">// 超时时间</span></span><br><span class="line">        Transport: transport, <span class="comment">//http.Transport是一个结构体，保存了连接管理配置信息</span></span><br><span class="line">        CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">			<span class="keyword">return</span> http.ErrUseLastResponse <span class="comment">/* 不进入重定向 */</span></span><br><span class="line">		&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发送刚才创建的请求</span></span><br><span class="line">    response, _ := client.Do(req)</span><br><span class="line"></span><br><span class="line">    fmt.Println(response.StatusCode)</span><br><span class="line">    fmt.Println(response.Header.Get(<span class="string">&quot;Server&quot;</span>))</span><br><span class="line">    body, _ := ioutil.ReadAll(response.Body)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(body))</span><br></pre></td></tr></table></figure>
<h3 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;regexp&quot;</span></span><br><span class="line">)</span><br><span class="line">    regex, _ := regexp.Compile(<span class="string">&quot;(\\d&#123;1,3&#125;)\\d&#123;1,3&#125;&quot;</span>)    <span class="comment">// 编译正则表达式，匹配1到3个数字字符</span></span><br><span class="line">    fmt.Println(regex.MatchString(<span class="string">&quot;123123123123&quot;</span>))    <span class="comment">//匹配， true</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(regex.FindString(<span class="string">&quot;123213123123&quot;</span>))     <span class="comment">//返回第一个匹配的子字符串123213</span></span><br><span class="line">    fmt.Println(regex.FindStringIndex(<span class="string">&quot;123213123123&quot;</span>))    <span class="comment">//返回第一个匹配子串的起始和结束索引[0 6]</span></span><br><span class="line">    fmt.Println(regex.FindStringSubmatch(<span class="string">&quot;123213123123&quot;</span>))    <span class="comment">//返回第一个匹配的子串及所有子匹配[123213 123]</span></span><br><span class="line">    fmt.Println(regex.FindAllString(<span class="string">&quot;123213123123&quot;</span>,<span class="number">-1</span>))    <span class="comment">//返回所有匹配的字符串[123213 123123] n表示为返回个数，-1则返回全部</span></span><br><span class="line">    fmt.Println(regex.FindAllStringSubmatch(<span class="string">&quot;123213123123&quot;</span>,<span class="number">-1</span>))    <span class="comment">//返回所有匹配的子串以及它们的子匹配[[123213 123] [123123 123]]</span></span><br><span class="line">    fmt.Println(regex.FindAll([]<span class="keyword">byte</span>(<span class="string">&quot;123123123123&quot;</span>), <span class="number">-1</span>))    <span class="comment">//通过字节去匹配，返回的也是字节的结果[[49 50 51 49 50 51] [49 50 51 49 50 51]] </span></span><br><span class="line"></span><br><span class="line">    fmt.Println(regex.ReplaceAllString(<span class="string">&quot;123123123213&quot;</span>,<span class="string">&quot;a&quot;</span>))    <span class="comment">//替换， aa</span></span><br></pre></td></tr></table></figure>


<h2 id="配置文件解析"><a href="#配置文件解析" class="headerlink" title="配置文件解析"></a>配置文件解析</h2><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">enable :</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">list :</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">aaa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bbb</span></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line">  <span class="attr">user :</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password :</span> <span class="string">haha</span></span><br><span class="line">  <span class="attr">port :</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Fingerprint</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;gopkg.in/yaml.v3&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="comment">// 定义结构体</span></span><br><span class="line">    <span class="keyword">type</span> Yaml <span class="keyword">struct</span> &#123;</span><br><span class="line">        Cache <span class="keyword">struct</span>&#123;</span><br><span class="line">            Enable <span class="keyword">bool</span> <span class="string">`yaml:&quot;enable&quot;`</span></span><br><span class="line">            List []<span class="keyword">string</span> <span class="string">`yaml:&quot;list,flow&quot;`</span></span><br><span class="line">        &#125;</span><br><span class="line">        Mysql <span class="keyword">struct</span>&#123;</span><br><span class="line">            User <span class="keyword">string</span> <span class="string">`yaml:&quot;user&quot;`</span></span><br><span class="line">            Password <span class="keyword">string</span> <span class="string">`yaml:&quot;password&quot;`</span></span><br><span class="line">            Port <span class="keyword">int</span> <span class="string">`yaml:&quot;port&quot;`</span></span><br><span class="line">        &#125;</span><br><span class="line">        Type <span class="keyword">string</span> <span class="string">`yaml:&quot;type,omitempty&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    result := <span class="built_in">new</span>(Yaml)</span><br><span class="line">    yamlFile, _ := ioutil.ReadFile(<span class="string">&quot;test.yml&quot;</span>)</span><br><span class="line">    _ = yaml.Unmarshal(yamlFile, result) <span class="comment">//提取yaml</span></span><br><span class="line">    result.Cache.Enable:=True</span><br><span class="line"></span><br><span class="line">    yamlFile, _ := os.OpenFile(<span class="string">&quot;test.yml&quot;</span>, os.O_RDWR|os.O_CREATE|os.O_TRUNC, <span class="number">0777</span>)</span><br><span class="line">	<span class="keyword">defer</span> yamlFile.Close()</span><br><span class="line">	enc := yaml.NewEncoder(yamlFile)</span><br><span class="line">	err := enc.Encode(result)<span class="comment">//写yaml</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//viper</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line">	vp := viper.New()</span><br><span class="line">	vp.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line">	vp.AddConfigPath(<span class="string">&quot;/var/&quot;</span>)</span><br><span class="line">	vp.SetConfigType(<span class="string">&quot;yaml&quot;</span>)</span><br><span class="line">	err := vp.ReadInConfig()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 使用UnmarshalKey来将&quot;database&quot;部分的配置反序列化到结构体config的Database属性</span></span><br><span class="line">	<span class="keyword">if</span> err := vp.UnmarshalKey(<span class="string">&quot;database&quot;</span>, &amp;config.Database); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error unmarshalling key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="json快速解析"><a href="#json快速解析" class="headerlink" title="json快速解析"></a>json快速解析</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/json-iterator/go&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/tidwall/gjson&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/tidwall/sjson&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体，变量名注意大写，因为跨到json包了</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">    Age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 初始化结构体</span></span><br><span class="line">    user := User&#123;</span><br><span class="line">        Name: <span class="string">&quot;d4m1ts&quot;</span>,</span><br><span class="line">        Age: <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化，转字符串</span></span><br><span class="line">    s1, _ := json.Marshal(user)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(s1))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化，恢复为原来的结构</span></span><br><span class="line">    user2 := User&#123;&#125;</span><br><span class="line">    json.Unmarshal(s1, &amp;user2)</span><br><span class="line">    fmt.Println(user2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">json := <span class="string">`&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;address&quot;: &#123;&quot;city&quot;: &#123;&quot;country&quot;: &quot;china&quot;, &quot;name&quot;: &quot;henu&quot;&#125;, &quot;zip&quot;: &quot;10001&quot;&#125;&#125;`</span></span><br><span class="line"><span class="comment">// 标准库 encoding/json 在使用时需要预先定义结构体，使用时显得不够灵活。这时候可以尝试使用其他模块</span></span><br><span class="line">	address := gjson.Get(json, <span class="string">&quot;address&quot;</span>)</span><br><span class="line">    enList:= address.Get(<span class="string">&quot;city&quot;</span>).Array()</span><br><span class="line"><span class="comment">// 修改字段值</span></span><br><span class="line">	json, _ = sjson.Set(json, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jane&quot;</span>)</span><br><span class="line"><span class="comment">// 添加新字段</span></span><br><span class="line">    json, _ = sjson.Set(json, <span class="string">&quot;address.city&quot;</span>, <span class="string">&quot;New York&quot;</span>)</span><br><span class="line"><span class="comment">// 删除字段</span></span><br><span class="line">    json, _ = sjson.Delete(json, <span class="string">&quot;address.city&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// github.com/json-iterator/go 模块</span></span><br><span class="line">    name := jsoniter.Get([]<span class="keyword">byte</span>(json), <span class="string">&quot;name&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;Name:&quot;</span>, name.ToString())  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="go-web"><a href="#go-web" class="headerlink" title="go web"></a>go web</h2><p>web系统编译设计原理都是相通的，翻来覆去就那些东西</p>
<h3 id="路由和传参"><a href="#路由和传参" class="headerlink" title="路由和传参"></a>路由和传参</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/fvbock/endless&quot;</span> <span class="comment">//允许你在不中断现有连接的情况下重启 Go HTTP 服务</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/astaxie/beego/validation&quot;</span><span class="comment">//使用beego框架的校验器</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> auth <span class="keyword">struct</span> &#123;</span><br><span class="line">	Username <span class="keyword">string</span> <span class="string">`valid:&quot;Required; MaxSize(50)&quot;`</span><span class="comment">//Required表示该字段是必填项，不能为空。MaxSize(50)表示最大长度为50个字符</span></span><br><span class="line">	Password <span class="keyword">string</span> <span class="string">`valid:&quot;Required; MaxSize(50)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetAuth</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	url := c.Request.URL.String()<span class="comment">//如http://127.0.0.1:8088/example?1=1，获取/example?1=1</span></span><br><span class="line"></span><br><span class="line">	username := c.Query(<span class="string">&quot;username&quot;</span>) <span class="comment">//c.Param(&quot;name&quot;)读取路径中的参数，c.Query为get传参</span></span><br><span class="line">    username:=c.DefaultQuery(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>)<span class="comment">//如果没有传参就为默认值</span></span><br><span class="line">	password := c.DefaultPostForm(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;0&quot;</span>) <span class="comment">// DefaultPostForm，只支持string类型，因此需要进行类型的转换</span></span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;person); err != <span class="literal">nil</span> &#123;&#125;<span class="comment">// 绑定JSON到结构体</span></span><br><span class="line"></span><br><span class="line">    session := sessions.Default(c)</span><br><span class="line">	session.Set(<span class="string">&quot;shallow&quot;</span>, userDir)<span class="comment">//写入session</span></span><br><span class="line">    shallow:=session.Get(<span class="string">&quot;shallow&quot;</span>)<span class="comment">//获取信息</span></span><br><span class="line">	session.Save()</span><br><span class="line"></span><br><span class="line">    file, err := c.FormFile(<span class="string">&quot;file&quot;</span>)<span class="comment">//从 HTTP 请求中获取上传的文件</span></span><br><span class="line">	ext := file.Filename[strings.LastIndex(file.Filename, <span class="string">&quot;.&quot;</span>):]<span class="comment">//获取文件扩展名</span></span><br><span class="line">	filename := userUploadDir + file.Filename</span><br><span class="line">	err = c.SaveUploadedFile(file, filename)<span class="comment">//将上传的文件保存到服务器上的指定位置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	valid := validation.Validation&#123;&#125;<span class="comment">// 创建一个验证器</span></span><br><span class="line">	a := auth&#123;Username: username, Password: password&#125;</span><br><span class="line">	ok, _ := valid.Valid(&amp;a)<span class="comment">// 验证数据的有效性</span></span><br><span class="line">	data := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	code := <span class="number">400</span></span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        c.Redirect(http.StatusFound, <span class="string">&quot;/&quot;</span>)<span class="comment">//StatusFound=302</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123; <span class="comment">//返回json</span></span><br><span class="line">		<span class="string">&quot;code&quot;</span> : code,</span><br><span class="line">		<span class="string">&quot;data&quot;</span> : data,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">//gin.Default()=gin.New()+r.Use(gin.Logger())+ r.Use(gin.Recovery())</span></span><br><span class="line">        r := gin.New() <span class="comment">//创建一个没有任何默认中间件的 Gin 引擎实例</span></span><br><span class="line"><span class="comment">//use添加中间件，默认情况下请求将沿中间件的添加顺序依次处理</span></span><br><span class="line">        r.Use(gin.Logger()) <span class="comment">// 添加日志中间件</span></span><br><span class="line">        r.Use(gin.Recovery()) <span class="comment">// 添加恢复中间件</span></span><br><span class="line">        r.Use(Cors()) <span class="comment">// 添加跨域中间件</span></span><br><span class="line">        </span><br><span class="line">        gin.SetMode(global.ServerSetting.RunMode)<span class="comment">//设置 Gin 的运行模式，可以是 &quot;debug&quot;、&quot;release&quot; 或 &quot;test&quot;</span></span><br><span class="line">        r.GET(<span class="string">&quot;/api/v1/auth&quot;</span>, GetAuth) <span class="comment">// 添加路由处理函数</span></span><br><span class="line"></span><br><span class="line">        apiv1 := r.Group(<span class="string">&quot;/api/v1&quot;</span>) <span class="comment">//创建一个路由组，所有在 /api/v1 下的路由都会归到这个组。</span></span><br><span class="line">        apiv1.GET(<span class="string">&quot;/downtasklog/:id&quot;</span>, v1.DownTaskLog) <span class="comment">//绑定到 /api/v1/downtasklog/:id 路由上</span></span><br><span class="line">        apiv1.Use(Midderware) <span class="comment">//为路由组添加JWT中间件</span></span><br><span class="line">        </span><br><span class="line">        endless.DefaultReadTimeOut = <span class="number">60</span></span><br><span class="line">        endless.DefaultWriteTimeOut = <span class="number">60</span></span><br><span class="line">        endless.DefaultMaxHeaderBytes = <span class="number">1</span> &lt;&lt; <span class="number">20</span></span><br><span class="line">        server := endless.NewServer(<span class="number">8081</span>, r) <span class="comment">// 创建endless服务器</span></span><br><span class="line">        err := server.ListenAndServe()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Midderware</span><span class="params">()</span> <span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		token := c.GetHeader(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> token == <span class="string">&#x27;&#x27;</span> &#123;</span><br><span class="line">			c.Abort()<span class="comment">//设置完成当前中间件后，不会再执行后面的中间件</span></span><br><span class="line">			<span class="keyword">return</span><span class="comment">//结束当前中间件的处理，继续执行下一个中间件</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.Next()<span class="comment">//继续执行下一个中间件,然后再回来</span></span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="鉴权"><a href="#鉴权" class="headerlink" title="鉴权"></a>鉴权</h3><h4 id="jwt鉴权"><a href="#jwt鉴权" class="headerlink" title="jwt鉴权"></a>jwt鉴权</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/dgrijalva/jwt-go&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jwtSecret = []<span class="keyword">byte</span>(<span class="string">&quot;213123dd1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Claims <span class="keyword">struct</span> &#123;</span><br><span class="line">	Username <span class="keyword">string</span> <span class="string">`json:&quot;username&quot;`</span></span><br><span class="line">	Password <span class="keyword">string</span> <span class="string">`json:&quot;password&quot;`</span></span><br><span class="line">	jwt.StandardClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateToken</span><span class="params">(username, password <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">	nowTime := time.Now()</span><br><span class="line">	expireTime := nowTime.Add(<span class="number">3</span> * time.Hour)</span><br><span class="line"></span><br><span class="line">	claims := Claims&#123;</span><br><span class="line">		username,</span><br><span class="line">		password,</span><br><span class="line">		jwt.StandardClaims&#123;</span><br><span class="line">			ExpiresAt: expireTime.Unix(),<span class="comment">// 设置过期时间</span></span><br><span class="line">			Issuer:    <span class="string">&quot;linglong&quot;</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tokenClaims := jwt.NewWithClaims(jwt.SigningMethodHS256, claims) <span class="comment">// 创建一个新的 JWT Token</span></span><br><span class="line">	token, err := tokenClaims.SignedString(jwtSecret) <span class="comment">// 使用密钥签名 JWT Token</span></span><br><span class="line">	<span class="keyword">return</span> token, err<span class="comment">//// 输出生成的 JWT</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseToken</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(*Claims, error)</span></span> &#123;</span><br><span class="line">	tokenClaims, err := jwt.ParseWithClaims(token, &amp;Claims&#123;&#125;, <span class="function"><span class="keyword">func</span><span class="params">(token *jwt.Token)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> jwtSecret, <span class="literal">nil</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> tokenClaims != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> claims, ok := tokenClaims.Claims.(*Claims); ok &amp;&amp; tokenClaims.Valid &#123;<span class="comment">// 如果 token 有效并且被解析</span></span><br><span class="line">			<span class="keyword">return</span> claims, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JWT</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		token := c.GetHeader(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> token == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			code = e.INVALID_PARAMS</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			claims, err := utils.ParseToken(token)</span><br><span class="line">			<span class="keyword">if</span> claims == <span class="literal">nil</span>&#123;</span><br><span class="line">				c.JSON(http.StatusUnauthorized, gin.H&#123;</span><br><span class="line">					<span class="string">&quot;code&quot;</span> : <span class="number">401</span>,</span><br><span class="line">					<span class="string">&quot;data&quot;</span> : data,</span><br><span class="line">				&#125;)</span><br><span class="line">				c.Abort()<span class="comment">//c.Abort()：中止请求，不会继续流转，也不会执行后续的中间件或处理函数</span></span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				code = e.ERROR</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> time.Now().Unix() &gt; claims.ExpiresAt &#123;</span><br><span class="line">				code =e.ERROR</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		c.Next()<span class="comment">//c.Next() 会让当前的请求继续流转到下一个中间件或者最终的处理函数</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> db *gorm.DB</span><br><span class="line">db, err = gorm.Open(<span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;user:password@tcp(localhost:3306)/dbname?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;</span>) <span class="comment">//连接数据库</span></span><br><span class="line"></span><br><span class="line">gorm.DefaultTableNameHandler = <span class="function"><span class="keyword">func</span><span class="params">(db *gorm.DB, defaultTableName <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> global.DatabaseSetting.TablePrefix + defaultTableName<span class="comment">//可以方便地为所有表名添加统一的前缀，便于管理和区分如app_user</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">db.SingularTable(<span class="literal">true</span>) <span class="comment">//默认false，gorm 会将结构体名称的复数形式作为表名，如结构体 User 对应的表名是 users。设置true，结构体 User 对应的表名是 user</span></span><br><span class="line">db.LogMode(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//操作</span></span><br><span class="line"><span class="comment">//插入单条数据</span></span><br><span class="line">student := Student&#123;Name: <span class="string">&quot;1&quot;</span>, Age: <span class="number">18</span>, Job: <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">tx := db.Create(&amp;student)  <span class="comment">// 通过数据的指针来创建</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//插入多条数据</span></span><br><span class="line">studs := []*Student&#123;</span><br><span class="line">	&amp;Student&#123;Name: <span class="string">&quot;aa&quot;</span>, Age: <span class="number">1</span>, Job: <span class="string">&quot;aa&quot;</span>&#125;,</span><br><span class="line">	&amp;Student&#123;Name: <span class="string">&quot;bb&quot;</span>, Age: <span class="number">2</span>, Job: <span class="string">&quot;bb&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">tx := db.Create(&amp;studs)</span><br><span class="line"></span><br><span class="line">tx.Error        <span class="comment">// 返回 error</span></span><br><span class="line">tx.RowsAffected <span class="comment">// 返回插入记录的条数</span></span><br><span class="line"></span><br><span class="line">db.Create(&amp;mainurllist)</span><br><span class="line">db.Model(&amp;User&#123;&#125;).Create(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123; <span class="comment">//默认 结构体 User 对应的表名是 users</span></span><br><span class="line">  <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;jinzhu&quot;</span>, <span class="string">&quot;Age&quot;</span>: <span class="number">18</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">db.Delete(&amp;user)</span><br><span class="line">db.Where(<span class="string">&quot;id = &quot;</span> + strconv.Itoa(id)).Delete(&amp;Finger&#123;&#125;)</span><br><span class="line"></span><br><span class="line">db.Model(&amp;user).Select(<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;Age&quot;</span>).Updates(User&#123;Name: <span class="string">&quot;new_name&quot;</span>, Age: <span class="number">0</span>&#125;)</span><br><span class="line"></span><br><span class="line">db.First(&amp;user, <span class="string">&quot;id = ?&quot;</span>, <span class="string">&quot;1&quot;</span>) <span class="comment">//First方法适用于查询满足条件的第一条记录</span></span><br><span class="line">db.Where(maps).Order(<span class="string">&quot;created_time&quot;</span>).Find(&amp;portbruteres)<span class="comment">//查询满足条件的多条记录，并将结果存储在切片中</span></span><br><span class="line"></span><br><span class="line">db.Exec(<span class="string">&quot;DELETE FROM users WHERE id = ?&quot;</span>, <span class="number">1</span>) <span class="comment">//sql语句执行</span></span><br></pre></td></tr></table></figure>


<h2 id="其他不重要的包"><a href="#其他不重要的包" class="headerlink" title="其他不重要的包"></a>其他不重要的包</h2><h3 id="github-com-olekukonko-tablewriter"><a href="#github-com-olekukonko-tablewriter" class="headerlink" title="github.com/olekukonko/tablewriter"></a>github.com/olekukonko/tablewriter</h3><p>在终端输出表格</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/olekukonko/tablewriter&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line">	<span class="comment">// 创建一个新的表格写入器，输出到标准输出（终端）</span></span><br><span class="line">	table := tablewriter.NewWriter(os.Stdout)</span><br><span class="line">	<span class="comment">// 设置表头</span></span><br><span class="line">	table.SetHeader([]<span class="keyword">string</span>&#123;<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;Age&quot;</span>, <span class="string">&quot;Country&quot;</span>&#125;)</span><br><span class="line">	<span class="comment">// 添加表格行</span></span><br><span class="line">	table.Append([]<span class="keyword">string</span>&#123;<span class="string">&quot;John&quot;</span>, <span class="string">&quot;30&quot;</span>, <span class="string">&quot;USA&quot;</span>&#125;)</span><br><span class="line">	table.Append([]<span class="keyword">string</span>&#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;25&quot;</span>, <span class="string">&quot;Canada&quot;</span>&#125;)</span><br><span class="line">	table.Append([]<span class="keyword">string</span>&#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;35&quot;</span>, <span class="string">&quot;UK&quot;</span>&#125;)</span><br><span class="line">	<span class="comment">// 渲染表格并输出</span></span><br><span class="line">	table.Render()</span><br><span class="line"></span><br><span class="line">data := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">		&#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;30&quot;</span>, <span class="string">&quot;USA&quot;</span>&#125;,</span><br><span class="line">		&#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;25&quot;</span>, <span class="string">&quot;UK&quot;</span>&#125;,</span><br><span class="line">		&#123;<span class="string">&quot;Charlie&quot;</span>, <span class="string">&quot;35&quot;</span>, <span class="string">&quot;Canada&quot;</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">table := tablewriter.NewWriter(os.Stdout)          <span class="comment">// 创建一个新的表格写入器，输出到标准输出（终端）</span></span><br><span class="line">table.SetAlignment(tablewriter.ALIGN_CENTER)       <span class="comment">// 设置表格列的对齐方式为居中</span></span><br><span class="line">table.AppendBulk(data)                             <span class="comment">// 批量添加数据到表格</span></span><br><span class="line">table.Render()                                     <span class="comment">// 渲染并输出表格</span></span><br></pre></td></tr></table></figure>

        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Golang/"># Golang</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2025/03/20/front/js/Vue.js%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/">Vue 简单学习</a>
            
            
            <a class="next" rel="next" href="/2024/11/11/java/package/jboss%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">jboss 反序列化</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© mayylu | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>